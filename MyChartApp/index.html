<!DOCTYPE HTML>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Tsuihiji's App with dbpedia</title>
  <meta charset="UTF-8">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript" src="http://mgskjaeveland.github.io/sgvizler/v/0.6/sgvizler.js"></script>
  <script type="text/javascript" src="d3.v3.min.js"></script>
  <script type="text/javascript" src="d3sparql.js"></script>
  <script type="text/javascript" src="input-jquery.js"></script>
  <script type="text/javascript">
    // Prefix の設定
    sgvizler.prefix('prop-ja', 'http://ja.dbpedia.org/property/');
    // HTMLファイルをロードしたら画面描画
    $(document).ready(function () { sgvizler.containerDrawAll(); });
    
    // 実行
    function exec(){
        var month = $('.chmon').val();
        var day = $('.chday').val();
        sparql = "PREFIX prop-ja:<http://ja.dbpedia.org/property/> SELECT distinct ?year ?name WHERE {?s prop-ja:生年 ?year; prop-ja:生月 " + month + "; prop-ja:生日 " + day + "; rdfs:label ?name.} ORDER BY ?year LIMIT 100"
        d3sparql.query("http://ja.dbpedia.org/sparql", sparql, render)
    }

    function render(json) {
        var config = {
          "selector": "#result"
        }
        d3sparql.htmltable(json, config)
    }
  </script>
</head>

<body>
  <h2>同じ誕生日の人が多い日上位20件</h2>
  <div id="sgvzl_example_query"
    data-sgvizler-endpoint="http://ja.dbpedia.org/sparql" 
    data-sgvizler-query="SELECT (CONCAT(?M,'/',?D) AS ?birthDay) (COUNT(?s) AS ?num)
                         WHERE{?a prop-ja:生月 ?M;
                           prop-ja:生日 ?D;
                           rdfs:label ?s.
                         } GROUP BY ?M ?D
                         ORDER BY DESC(?num) 
                         LIMIT 20"
    data-sgvizler-chart="google.visualization.BarChart" 
    data-sgvizler-loglevel="2"
    style="width:800px; height:400px;">
  </div>


  <h2>あなたと同じ誕生日の人は？</h2>

  <select name="birthM" class="chmon">
    <script>
      var option = '';
      for (var i = 1; i <= 12; i++) {
        option += '<option value="' + i + '">' + i + '</option>\n';
      }
      $('.chmon').html(option);
    </script>
  </select> 月
  
  <select name="birthD" class="chday">
    <script>
      var option = '';
      for (var i = 1; i <= 31; i++) {
        option += '<option value="' + i + '">' + i + '</option>\n';
      }
      $('.chday').html(option);
    </script>
  </select> 日

  <!-- 間違った範囲の日にちが選択されないように制限 -->
  <script>
    $('.chmon').change(function() {
      formSetDay();
    })
  </script>

  <button class="btn" type="button" onclick="exec()">検索</button>

  <div id="result"></div>

</body>

</html>